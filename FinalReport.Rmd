---
title: "The Fashionability of Flu Shots for the Medicare Population"
author: "Rachel Donahue"
geometry: margin=2cm
date: "12/12/2021"
output:
  pdf_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
library(tidyverse)
library(openxlsx)
library(dplyr)
library(usmap)
library(lme4)
library(vcd)
library(rstanarm)
library(gridExtra)
library(arm)
library(sjPlot)
```
## Abstract

As vaccine hesitancy has become a pressing issue in efforts to combat the Covid-19 pandemic, it seems worth exploring how the sizable and vulnerable Medicare population was already utilizing vaccinations for an extant dangerous illness, influenza (flu). This leads to questions of "How has Medicare flu vaccination rates been changing over the last several years?" and "How does that rate vary across states?". To make these comparisons, a multilevel poisson model was fitted on Medicare claims data from 2013-2019, which yielded an overall fixed effect of a decline in the rate of flu shot distributions for that period of time, and states such as California which has the largest amount of Medicare patients showed an even steeper decline than the fixed effects. Comparisons of provider types were also explored, yielding a fixed effect increase of vaccination administration coming from entities rather than individuals. This is key information that could inform public health messaging strategies for a world that gets accustomed to frequent seasonal vaccinations for Covid-19.

## Introduction

The United States Medicare program is a federal health insurance program that services predominately people 65 years of age and older. As of 2020, over 62.6 million people are enrolled with a projected increase of 50% over the next decade as all of the members of the "Baby Boomer" generation reach the qualifying age. Care for this population will put tremendous strain on the healthcare system, and it will become crucial to maximize individual participation in preventative health measures to reduce this burden. 

Caring for flu patients is one of those strenuous healthcare activities that can be reduced by vaccinations. Flu illness routinely hospitalizes hundreds of thousands of people every year and causes thousands of deaths, seasonal flu vaccination is estimated to reduce the risk of having to seek medical treatment by 40-60%. The Medicare population is a high proportion of these cases as they are a large proportion of the broader US population. However there are differences in the enrollment rates per state, which is important to take into consideration. An additional comparison worth exploring is the means by which Medicare patients pursue vaccinations in these state groupings; if more beneficiaries are getting vaccinated through organizations such as a local CVS pharmacy or their individual healthcare provider, this creates different avenues through which public health campaigns may be more effective.

Multilevel poisson modeling is used to assess these comparisons in flu vaccinations rates among this population.

## Method

### Data

The data that is being used to fit the model comes from two sources- one from the Medicare Physician & Other Practitioners- by Provider and Service public use files provided by the Centers for Medicare & Medicaid (CMS) website and one from the American Community Survey provided by the US Census Bureau. The CMS data set contains all of the services that providers have submitted claims through out the year for Original Medicare Part B beneficiaries, broken out by National Provider Identifier (NPI) number and HCPCS code. Filtering was applied to obtain flu shot specific charges, additional details can be found in the appendix. The ACS data set contains the estimates of the Medicare population for each state for the years 2013-2019.

\newpage
```{r include=FALSE}

library(tidyverse)
library(openxlsx)
library(dplyr)
library(stringr)

unzip("2013-zip.zip")
thirteen<-read.csv("2013.csv")
unzip("2014-zip.zip")
fourteen<-read.csv("2014.csv")
unzip("2015-zip.zip")
fifteen<-read.csv("2015.csv")
unzip("2016-zip.zip")
sixteen<-read.csv("2016.csv")
unzip("2017-zip.zip")
seventeen<-read.csv("2017.csv")
unzip("2018-zip.zip")
eighteen<-read.csv("2018.csv")
unzip("2019-zip.zip")
nineteen<-read.csv("2019.csv")

nineteen$Year<-"2019"
eighteen$Year<-"2018"
seventeen$Year<-"2017"
sixteen$Year<-"2016"
fifteen$Year<-"2015"
fourteen$Year<-"2014"
thirteen$Year<-"2013"

nineteen$yearnum<-7
eighteen$yearnum<-6
seventeen$yearnum<-5
sixteen$yearnum<-4
fifteen$yearnum<-3
fourteen$yearnum<-2
thirteen$yearnum<-1

data<-rbind(nineteen, eighteen, seventeen, sixteen, fifteen, fourteen, thirteen)

data<-data%>%filter(HCPCS_Cd=="G0008")

dataframe<-data[, c(1:2, 7, 11, 17, 23,26, 29:31)]
names(dataframe)<- c("NPI", "Name",  "EntityFlag", "State", "PrcType", "Benes", "TotalCharges", "MedicarePaymentAmount", "Year", "yearnum")

flushots<-dataframe %>% filter(State!="AA"&State!="AE"&State!="XX"&State!="AP"&State!="MP"&State!="VI"&State!="GU"&State!="PR")


ACS19<-read.xlsx("ACS2019.xlsx")
ACSdf19<-ACS19[9:59, 1:2]
names(ACSdf19)<-c("state", "estimate")
ACSdf19$Year<-"2019"
ACSdf19$yearnum<-7
ACSdf19$estimate<-as.numeric(ACSdf19$estimate)
ACSdf19$estimate<-ACSdf19$estimate*1000

ACS18<-read.xlsx("ACS2018.xlsx")
ACSdf18<-ACS18[7:59, 1:2]
names(ACSdf18)<-c("state", "estimate")
ACSdf18$Year<-"2018"
ACSdf18$yearnum<-6
ACSdf18$state<-str_to_title(tolower(ACSdf18$state))
ACSdf18$estimate<-as.numeric(ACSdf18$estimate)
ACSdf18$estimate<-ACSdf18$estimate*1000

ACS17<-read.xlsx("ACS2017.xlsx")
ACSdf17<-ACS17[7:59, 1:2]
names(ACSdf17)<-c("state", "estimate")
ACSdf17$Year<-"2017"
ACSdf17$yearnum<-5
ACSdf17$state<-str_to_title(tolower(ACSdf17$state))
ACSdf17$estimate<-as.numeric(ACSdf17$estimate)
ACSdf17$estimate<-ACSdf17$estimate*1000

ACS16<-read.xlsx("ACS2016.xlsx")
ACSdf16<-ACS16[8:59, 1:2]
names(ACSdf16)<-c("state", "estimate")
ACSdf16$Year<-"2016"
ACSdf16$yearnum<-4
ACSdf16$state<-str_to_title(tolower(ACSdf16$state))
ACSdf16$estimate<-as.numeric(ACSdf16$estimate)
ACSdf16$estimate<-ACSdf16$estimate*1000

ACS15<-read.xlsx("ACS2015.xlsx")
ACSdf15<-ACS15[8:59, 1:2]
names(ACSdf15)<-c("state", "estimate")
ACSdf15$Year<-"2015"
ACSdf15$yearnum<-3
ACSdf15$state<-str_to_title(tolower(ACSdf15$state))
ACSdf15$estimate<-as.numeric(ACSdf15$estimate)
ACSdf15$estimate<-ACSdf15$estimate*1000

ACS14<-read.xlsx("ACS2014.xlsx")
ACSdf14<-ACS14[8:59, 1:2]
names(ACSdf14)<-c("state", "estimate")
ACSdf14$Year<-"2014"
ACSdf14$yearnum<-2
ACSdf14$state<-str_to_title(tolower(ACSdf14$state))
ACSdf14$estimate<-as.numeric(ACSdf14$estimate)
ACSdf14$estimate<-ACSdf14$estimate*1000

#Thirteen's different

ACS13<-read.xlsx("ACS2013.xlsx")
ACSdf13<-ACS13[51:54,]
z_<-as.data.frame(t(ACSdf13[2:4, 2:206]))
names(z_)<-c("state", "Group","estimate")
z_<-subset(z_, z_$Group=="All persons")
z_<-z_[2:nrow(z_),c(1,3)]
ACSdf13<-z_
ACSdf13$Year<-"2013"
ACSdf13$yearnum<-1
ACSdf13$state<-str_to_title(tolower(ACSdf13$state))
ACSdf13$estimate<-as.numeric(ACSdf13$estimate)
ACSdf13$estimate<-ACSdf13$estimate*1000


ACS<-rbind(ACSdf19, ACSdf18, ACSdf17, ACSdf16, ACSdf15, ACSdf14, ACSdf13)

ACS$State<-state.abb[match(ACS$state,state.name)]

ACS$State<-ifelse(ACS$state=="District Of Columbia"|ACS$state=="District of Columbia", "DC", ACS$State)

ACS<-ACS%>%filter(estimate!="NA")

ACS<-ACS%>%dplyr::select(State,Year,estimate,yearnum)

flushot_s<-aggregate(Benes~State+Year+EntityFlag+yearnum, data=flushots, sum)

flushot_s<-left_join(flushot_s, ACS, by=c("State", "Year", "yearnum"))

```
| Column names      | Explanation |
| :--:              | :----- |
| State             | The registration state of the provider|
| Year              | The year of the claims submitted |
| EntityFlag        | If the provider was an Individual=I or and Organization=O|
| Benes             | The number of unique Medicare Beneficiaries serviced|
| estimate          | Medicare population estimates for that state and year |
| yearnum           | The indexing number for the year, 2013=1...2019=7|


### Exploratory Data Analysis
```{r include=FALSE}

region_lookup <- data.frame(state.abb,state.division)
names(region_lookup)<-c("State", "Division")
f<-left_join(flushot_s, region_lookup, by=c("State"))


a<-aggregate(Benes~State+Year, data=flushots, sum) 
a2<-left_join(a, ACS, by=c("State", "Year"))
names(region_lookup)<-c("State", "Division")
a2<-left_join(a2, region_lookup, by=c("State"))
```
```{r include=FALSE}
p<-ggplot(a2, aes(x=Benes, y=estimate, color=State))+geom_point()+labs(x="Number of Beneficiaries Receiving Flu Shots", y="Beneficiaries Per State")+ ggtitle("Beneficiaries receiving Flu Shots versus Population Estimates")+facet_wrap(~Year)+theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 7), axis.title = element_text(size = 9), title = element_text(size = 9), legend.title=element_text(size=9), legend.key.size = unit(0.2, "cm"))

p1<-ggplot(a2%>%filter(Division=="New England"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+ggtitle("Flu Shot rates per State in New England")+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

p2<-ggplot(f%>%filter(Division=="New England"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~EntityFlag)+ggtitle("Flu Shot rates per State in New England by Provider Type")+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

```

``` {r echo=FALSE, fig.height=2.7, fig.width=6, fig.align='center'}
p
```

This plot explores the relationship between the number of flu shot recipients and the Medicare population as a whole, and it is apparent that states that have higher numbers of flu shot recipients also have a higher Medicare population. This justifies utilizing a poisson model with a population offset term to account for these differences.

``` {r echo=FALSE, fig.height=2.7, fig.width=6, fig.align='center'}
p1
```

To make it easier to see patterns in each of the 50 states, line graphs were restricted to different geographic regions in the United States. Each of the states in New England are included here, the full state results are included in the appendix. This plot shows that there does seem to be a declining linear pattern in the proportion of Medicare Beneficiaries receiving flu shots for each of the states, although at different rates.


``` {r echo=FALSE, fig.height=2.7, fig.width=6, fig.align='center'}
p2
```

This plot additionally shows that there are differences in how rates have changed over time per state when broken out by provider type. Although there is a general downward trend in vaccination rates for states in the New England region, however for some states those vaccinations are increasingly taking place at organizations instead of individual providers. 

### Model Fitting


Considering the interest is in comparing counts of flu shots across states over time and at different provider types, a multilevel poisson model is appropriate with population estimates used for offset terms. 

```{r eval=FALSE}
model<-glmer(Benes~EntityFlag+yearnum+(yearnum|State) +(EntityFlag|State), 
offset=log(estimate),      
data=flushot_s, 
family=poisson(link=log))

```

The summary of the fixed effects are in the table below, yearnum is significant at a .1 significance level:

|                |Estimate   |Std. Error    |z value |Pr(>&#124;t&#124;) |
|:---:           |:---:      |:---:         |:---:       |:---:              |
|(Intercept)     |-2.086     |0.066         |-31.370    |<2e-16 ***         |
|EntityFlag(O)   |0.126      |0.08          |1.583      |0.1135             |
|yearnum         |-0.017     |0.009         |-1.755     |0.0792 .           |

## Result

## Model Coefficients

To use the state of Maine as an example since they are the state with the lowest vaccination rates in New England, the model coefficients are as follows:

$$log(Benes/estimate)= -1.74 + 0.76\cdot EntityFlag(O)  - 0.08\cdot yearnum$$

Exponentiating both sides allows the equation be interpreted as:
$$Benes/estimate=(0.175)*(1.079)^{EntityFlag} * (0.923)^{yearnum}$$
```{r include=FALSE}
model<-glmer(Benes~EntityFlag+yearnum+(yearnum|State) +(EntityFlag|State), 
offset=log(estimate),      
data=flushot_s, 
family=poisson(link=log))

```

Since the outcome variable is a proportion of individuals, it makes sense for the intercept to be 0.175. While it is not possible to have a year 0 in this context, the year coefficient shows that for every year increase, the proportion of Medicare beneficiaries receiving flu shots decreases by about 7%. The Entity Flag coefficient compares the proportion of Medicare beneficiaries that receive flu shots from organizations to individuals, there is a 7% increase in the proportion of beneficiaries receiving flu shots from organizations than individual providers in the state of Maine.


```{r echo=FALSE, fig.height=3, fig.width=5, fig.align='center'}
set.seed(428)
simofbs<-sim(model)
hist(simofbs@ranef$State[,"ME",2], main="ME", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"ME",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"ME",2],c(0.975)),col="red")
```

The above plot shows simulations of the random effects for the yearnum coefficient and their frequencies for Maine, with the red lines displaying the cut off levels for an interval containing the true value with 95% probability. The  random effects for the yearnum coefficient for Maine is -0.07071, which falls close to the center of this interval. This shows that Maine has a lower yearnum coefficient compared to the overall fixed effects coefficient, indicating a steeper decline in flu shot rates compared to the overall average.

For each state, the effects of each coefficient are different. For example in California, which has the largest state Medicare population as of 2019, the baseline intercept is a little bit larger, and the entity comparison is in the opposite direction of more beneficiaries receiving flu shots over time from individuals rather than organizations. The yearnum coefficient is still negative similar to Maine, showing an overall decline in flu shot rates over time.

```{r echo=FALSE, fig.height=3, fig.width=5, fig.align='center'}
hist(simofbs@ranef$State[,"CA",2], main="CA", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"CA",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"CA",2],c(0.975)),col="red")
```

The above plot shows a simulation of the random effects for the yearnum coefficient and their frequencies for California, with the red lines displaying the cut off levels for an interval containing the true value with 95% probability. The  random effects for the yearnum coefficient for Maine is -0.01804, which falls with in this interval. This is also negative difference from the fixed effects coefficient, showing a sharper decline in flu shot rates compared to the overall average.

## Discussion

There were some challenges fitting an optimal model that are noted in the appendix, which leads to some limitations with this analysis. Quasipoisson and negative binomial multilevel models were also considered, however errors resulted that were not fixable. Other methods for running the model were also considered such as stan_glmer, but the model did not converge. Based on these challenges this was the best model that could be composed.

Another key limitation to this analysis comes from the data- it is impossible to get the true numbers of the Medicare beneficiaries that received flu shots from 2013-2019. If beneficiaries are able to obtain shots through a free clinic that did not require insurance to pay for it, then that scenario is unrecorded here. Another key restriction is the population estimates- the ACS survey is an estimate for patients that have both Medicare Part A and B, although it's estimated that 93% of Medicare patients do have both insurances and that an estimate for both can be a sufficient estimate for one, it is likely an overestimate for that Part B population and observed flu vaccination rates are likely higher. 

Despite limitations, this analysis still produces interesting considerations. Given the observed decline in flu shot rates for the United States Medicare population as a whole for each year during this period, it is almost unsurprising that there were difficulties encountered getting people to comply during the initial Covid-19 vaccination campaign by public health officials. Furthermore seeing that of those who were getting vaccinated, an increased share were going to entities rather than individual care providers, which perhaps indicates an increased association of vaccination with corporations and governments rather than something a trusted care provider recommends and administers. While from an efficiency standpoint it makes sense that the future of seasonal vaccination administration likely lies in the hands of these entities, it is important for public health officials to take note so outreach strategies can be framed around this context.

The state level comparison is a strength of this analysis. Different states have different shares of the Medicare population and therefore have different requirements for potential successful public vaccination campaigns. Knowing which states were observing sharper changes than average in flu vaccinations over time and which were deviating from the entity level comparison, gives an opportunity for more targeted messaging efforts. California for example, the state with the largest amount of Medicare Beneficiaries and would be a key state to focus on to make improvements, deviates somewhat from the trend of increased share of entity level vaccination. Considering that it is a large state with a mix of urban and rural areas, it is possible that certain people do not have convenient access to either a pharmacy or a care provider for geographic reasons, and understanding these challenges can be key to making improvements in vaccination rates.


## Citations

A Dozen Facts About Medicare Advantage in 2020. (2021, January 13). KFF. https://www.kff.org/medicare/issue-brief/a-dozen-facts-about-medicare-advantage-in-2020/

Burden of Influenza. (2021, October 4). Centers for Disease Control and Prevention. https://www.cdc.gov/flu/about/burden/index.html

Centers for Medicare & Medicaid Services Data. (2021). Center for Medicare & Medicaid Services. https://data.cms.gov/provider-summary-by-type-of-service/medicare-physician-other-practitioners/medicare-physician-other-practitioners-by-provider-and-service

US Census Bureau. (2021, October 8). American Community Survey Tables for Health Insurance Coverage. Census.Gov. https://www.census.gov/data/tables/time-series/demo/health-insurance/acs-hi.2013.html


\newpage
## Appendix

### Data Cleaning and Processing
To subset down to flu shot related charges for each available year, filtering was applied for selected the columns HCPCS_Desc for charges containing the words "flu" and "vaccine". Additional filtering was applied for Rndrng_Prvdr_Cntry="US". The ACS data set gives population estimates for the Medicare Part A and B populations in each of the following states through out the years which was estimated through the American Community survey for 2014-2019, the Current Population survey for 2013.

Once all the claims data sets were combined together they were then additionally subsetted down for just HCPCS code "G0008" in order to get at appropriate counts for unique beneficiaries. This is an administrative type II HCPCS code used specifically for the influenza vaccine that would be used in conjunction with other types of codes for billing, as it is the code most commonly used to bill for influenza vaccines it made sense to limit the data set to just that. Additionally territories and military bases to focus on the 50 states and the District of Columbia. Once that was complete there were  1,008,254 rows in the data set.

To allow for population proportion comparisons, the data was then aggregated by state, year, and entity status. They were then paired with the state population estimates from the ACS survey, which would be used in the regression for the offset term. The original data needed multiplied by 1000 to obtain the whole estimate number. 

### Model Validation


```{r echo=FALSE, fig.height=2, fig.align='center'}

z<-as.data.frame(cbind(fitted(model), resid(model)))
names(z)<-c("Fitted", "Residuals")

g<-ggplot(data=z, aes(x=Fitted, y=Residuals))+geom_point(color="light blue")+theme_bw()+ggtitle("Residual Plot")

g

```

The mean of the residual plot is almost 0, however there does seem to be a heteroscedastic pattern with most of the residuals clustering towards the left hand side of the graph.
```{r include=FALSE}

yhat=predict(model, type="response")/flushot_s$estimate
z <- (flushot_s$Benes/flushot_s$estimate-yhat)/sqrt(yhat)
n=length(flushot_s$Benes)
k=length(flushot_s$Benes)-1
sum(z^2)/(n-k)

```
The overdispersion ratio is 2.3 which is greater than 1, which does indicate that the mean exceeds the variance which is a violation of the equal mean and equal variance assumption required for Poisson.


```{r echo=FALSE, fig.align='center'}
rootogram(flushot_s[,5]/flushot_s[,6], predict(model)/flushot_s[,6])
```


Rootogram plot showing potential model prediction issues



### More EDA

```{r echo=FALSE , fig.height=3, fig.width=6, fig.align='center'}
flushot_s$state<-flushot_s$State

plot_usmap(regions="states", data = flushot_s%>%filter(Year=="2019"), values = "estimate", color = "black") + scale_fill_continuous(low="white", high="blue", name="Beneficiaries", label = scales::comma)+labs(title = "Estimates of Medicare Beneficiaries Per State 2019")

#DC needs special treatment to get a region
region_lookup <- data.frame(state.abb,state.division)
names(region_lookup)<-c("State", "Division")
f_<-subset(flushot_s, State!="DC")
f2<-left_join(f_, region_lookup, by=c("State"))
f3<-subset(flushot_s, State=="DC")
f3$Division="South Atlantic"
f<-rbind(f3,f2)

ggplot(a2%>%filter(Division=="Middle Atlantic"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(a2%>%filter(Division=="East North Central"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(a2%>%filter(Division=="West North Central"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(a2%>%filter(Division=="South Atlantic"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))


ggplot(a2%>%filter(Division=="New England"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(a2%>%filter(Division=="Mountain"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(a2%>%filter(Division=="West South Central"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(a2%>%filter(Division=="East South Central"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(a2%>%filter(Division=="Pacific"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(f%>%filter(Division=="Middle Atlantic"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(EntityFlag~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(f%>%filter(Division=="East North Central"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(EntityFlag~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(f%>%filter(Division=="West North Central"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(EntityFlag~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(f%>%filter(Division=="South Atlantic"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(EntityFlag~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(f%>%filter(Division=="New England"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(EntityFlag~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(f%>%filter(Division=="Mountain"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(EntityFlag~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(f%>%filter(Division=="West South Central"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(EntityFlag~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(f%>%filter(Division=="East South Central"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(EntityFlag~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

ggplot(f%>%filter(Division=="Pacific"), aes(x=Year, y=Benes/estimate, color=State, group=State))+geom_point()+geom_smooth(method="lm",se=F)+facet_wrap(EntityFlag~Division)+labs(y="Proportion of Beneficiaries receiving Flu Shots")+ theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.text = element_text(size = 8), axis.title = element_text(size = 9), title = element_text(size = 9))

```


\newpage
Full set of random effect yearnum histograms for each state:

```{r echo=FALSE, fig.align='center'}
hist(simofbs@ranef$State[,"AK",2], main="AK", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"AK",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"AK",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"AL",2], main="AL", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"AL",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"AL",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"AR",2], main="AR", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"AR",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"AR",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"AZ",2], main="AZ", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"AZ",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"AZ",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"CA",2], main="CA", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"CA",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"CA",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"CO",2], main="CO", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"CO",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"CO",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"CT",2], main="CT", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"CT",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"CT",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"DC",2], main="DC", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"DC",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"DC",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"DE",2], main="DE", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"DE",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"DE",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"FL",2], main="FL", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"FL",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"FL",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"GA",2], main="GA", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"GA",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"GA",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"HI",2], main="HI", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"HI",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"HI",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"IA",2], main="IA", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"IA",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"IA",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"ID",2], main="ID", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"ID",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"ID",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"IL",2], main="IL", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"IL",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"IL",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"IN",2], main="IN", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"IN",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"IN",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"KS",2], main="KS", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"KS",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"KS",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"KY",2], main="KY", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"KY",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"KY",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"LA",2], main="LA", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"LA",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"LA",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"MA",2], main="MA", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"MA",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"MA",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"MD",2], main="MD", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"MD",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"MD",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"ME",2], main="ME", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"ME",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"ME",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"MI",2], main="MI", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"MI",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"MI",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"MN",2], main="MN", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"MN",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"MN",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"MO",2], main="MO", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"MO",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"MO",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"MS",2], main="MS", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"MS",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"MS",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"MT",2], main="MT", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"MT",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"MT",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"NC",2], main="NC", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"NC",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"NC",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"ND",2], main="ND", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"ND",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"ND",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"NE",2], main="NE", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"NE",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"NE",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"NH",2], main="NH", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"NH",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"NH",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"NJ",2], main="NJ", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"NJ",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"NJ",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"NM",2], main="NM", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"NM",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"NM",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"NV",2], main="NV", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"NV",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"NV",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"NY",2], main="NY", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"NY",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"NY",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"OH",2], main="OH", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"OH",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"OH",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"OK",2], main="OK", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"OK",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"OK",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"OR",2], main="OR", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"OR",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"OR",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"PA",2], main="PA", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"PA",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"PA",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"RI",2], main="RI", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"RI",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"RI",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"SC",2], main="SC", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"SC",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"SC",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"SD",2], main="SD", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"SD",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"SD",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"TN",2], main="TN", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"TN",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"TN",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"TX",2], main="TX", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"TX",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"TX",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"UT",2], main="UT", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"UT",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"UT",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"VA",2], main="VA", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"VA",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"VA",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"VT",2], main="VT", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"VT",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"VT",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"WA",2], main="WA", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"WA",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"WA",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"WI",2], main="WI", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"WI",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"WI",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"WV",2], main="WV", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"WV",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"WV",2],c(0.975)),col="red")
hist(simofbs@ranef$State[,"WY",2], main="WY", xlab="Simulated Yearnum Random Effects Frequency", col="aliceblue")
abline(v=quantile(simofbs@ranef$State[,"WY",2],c(0.025)),col="red")
abline(v=quantile(simofbs@ranef$State[,"WY",2],c(0.975)),col="red")

```


\newpage
###Full Results

```{r echo=FALSE}
ranef(model)
```
Fixed effects of model
```{r echo=FALSE}
fixef(model)
```
Coefficients of model
```{r echo=FALSE}
coef(model)
```

